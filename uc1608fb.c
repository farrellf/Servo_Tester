/*********************************************************************************
 * SMALL LIBRARY FOR WRITING DATA TO UC1608FB LCD CONTROLLERS VIA BIT BANGING    *
 *********************************************************************************
 * The UC1608FB LCD controller supports up to 240x128 pixels but the LCD used in *
 * this project is 240x90.                                                       *
 *********************************************************************************
 * A 16x8 pixel font is used, allowing for 5.625 lines, each with 30 characters. *
 *********************************************************************************
 * The pixel buffer is also used as a splash screen when the device is turned    *
 * on. A black-and-white image can be converted into an array of bytes fairly    *
 * easily with The GIMP. Open or create a 240x96 pixel image, then rotate it     *
 * clockwise 90 degrees. Split the image into a bunch of 8px-wide columns, and   *
 * reverse the order of the columns. The first column becomes the last, etc.     *
 * Save the image as an XBM, and paste array from that file into the pixBuf[]    *
 * array below.                                                                  *
 *********************************************************************************/

#include "uc1608fb.h"
#include "stm32f0xx.h"

uint8_t pixBuf[240][12] = {0}; // optionally fill this with splash screen pixels

const uint16_t font[91][8] = {
	{0b0000000000000000,0b0000000000000000,0b0000000000000000,0b0000000000000000,0b0000000000000000,0b0000000000000000,0b0000000000000000,0b0000000000000000}, // ASCII 32, space
	{0b0000000000000000,0b0000000000000000,0b0011111111001100,0b0011111111001100,0b0000000000000000,0b0000000000000000,0b0000000000000000,0b0000000000000000}, // !
	{0b0011111100000000,0b0011111100000000,0b0000000000000000,0b0000000000000000,0b0011111100000000,0b0011111100000000,0b0000000000000000,0b0000000000000000}, // "
	{0b0000110000110000,0b0011111111111100,0b0011111111111100,0b0000110000110000,0b0011111111111100,0b0011111111111100,0b0000110000110000,0b0000000000000000}, // #
	{0b0001110000110000,0b0011111000110000,0b1111011100111100,0b1111001110111100,0b0011000111110000,0b0011000011100000,0b0000000000000000,0b0000000000000000}, // $
	{0b0011110000001100,0b0011110000111100,0b0000000011110000,0b0000001111000000,0b0000111100000000,0b0011110000111100,0b0011000000111100,0b0000000000000000}, // %
	{0b0000000011111000,0b0111101111111100,0b1111111100001100,0b1100111111011100,0b1111110011110000,0b0111000011111100,0b0000000011001100,0b0000000000000000}, // &
	{0b0000000000000000,0b0000000000000000,0b0011111100000000,0b0011111100000000,0b0000000000000000,0b0000000000000000,0b0000000000000000,0b0000000000000000}, // '
	{0b0000000000000000,0b0000000000000000,0b0000111111110000,0b0001111111111000,0b0011100000011100,0b0011000000001100,0b0000000000000000,0b0000000000000000}, // (
	{0b0011000000001100,0b0011100000011100,0b0001111111111000,0b0000111111110000,0b0000000000000000,0b0000000000000000,0b0000000000000000,0b0000000000000000}, // )
	{0b0000001100000000,0b0011001100110000,0b0011111111110000,0b0000111111000000,0b0011111111110000,0b0011001100110000,0b0000001100000000,0b0000000000000000}, // *
	{0b0000001100000000,0b0000001100000000,0b0011111111110000,0b0011111111110000,0b0000001100000000,0b0000001100000000,0b0000000000000000,0b0000000000000000}, // +
	{0b0000000000000000,0b0000000000000011,0b0000000000111111,0b0000000000111100,0b0000000000000000,0b0000000000000000,0b0000000000000000,0b0000000000000000}, // ,
	{0b0000001100000000,0b0000001100000000,0b0000001100000000,0b0000001100000000,0b0000001100000000,0b0000001100000000,0b0000000000000000,0b0000000000000000}, // -
	{0b0000000000000000,0b0000000000000000,0b0000000000011100,0b0000000000011100,0b0000000000000000,0b0000000000000000,0b0000000000000000,0b0000000000000000}, // .
	{0b0000000000001100,0b0000000000111100,0b0000000011110000,0b0000001111000000,0b0000111100000000,0b0011110000000000,0b0011000000000000,0b0000000000000000}, // /
	{0b0001111111111000,0b0011111111111100,0b0011000000001100,0b0011000000001100,0b0011111111111100,0b0001111111111000,0b0000000000000000,0b0000000000000000}, // 0
	{0b0000000000001100,0b0000110000001100,0b0011111111111100,0b0011111111111100,0b0000000000001100,0b0000000000001100,0b0000000000000000,0b0000000000000000}, // 1
	{0b0001110000001100,0b0011110000111100,0b0011000011111100,0b0011001111001100,0b0011111100001100,0b0001110000001100,0b0000000000000000,0b0000000000000000}, // 2
	{0b0011000000111000,0b0011000000111100,0b0011001100001100,0b0011111111001100,0b0011110011111100,0b0011000000111000,0b0000000000000000,0b0000000000000000}, // 3
	{0b0000000011110000,0b0000001111110000,0b0000111100110000,0b0011111111111100,0b0011111111111100,0b0000000000110000,0b0000000000000000,0b0000000000000000}, // 4
	{0b0011111100111000,0b0011111100111100,0b0011001100001100,0b0011001110001100,0b0011000111111100,0b0011000011111000,0b0000000000000000,0b0000000000000000}, // 5
	{0b0001111111111000,0b0011111111111100,0b0011001100001100,0b0011001100001100,0b0011001111111100,0b0000000111111000,0b0000000000000000,0b0000000000000000}, // 6
	{0b0011000000000000,0b0011000000111100,0b0011000011111100,0b0011001111000000,0b0011111100000000,0b0011100000000000,0b0000000000000000,0b0000000000000000}, // 7
	{0b0001110011111000,0b0011111111111100,0b0011001100001100,0b0011001100001100,0b0011111111111100,0b0001110011111000,0b0000000000000000,0b0000000000000000}, // 8
	{0b0001111000000000,0b0011111100001100,0b0011001100001100,0b0011001100011000,0b0011111111111000,0b0001111111100000,0b0000000000000000,0b0000000000000000}, // 9
	{0b0000000000000000,0b0000011100111000,0b0000011100111000,0b0000000000000000,0b0000000000000000,0b0000000000000000,0b0000000000000000,0b0000000000000000}, // :
	{0b0000000000000000,0b0000000000000011,0b0000111100111111,0b0000111100111100,0b0000000000000000,0b0000000000000000,0b0000000000000000,0b0000000000000000}, // ;
	{0b0000000000000000,0b0000001100000000,0b0000111111000000,0b0011110011110000,0b1111000000111100,0b1100000000001100,0b0000000000000000,0b0000000000000000}, // <
	{0b0000110000110000,0b0000110000110000,0b0000110000110000,0b0000110000110000,0b0000110000110000,0b0000110000110000,0b0000000000000000,0b0000000000000000}, // =
	{0b1100000000001100,0b1111000000111100,0b0011110011110000,0b0000111111000000,0b0000001100000000,0b0000000000000000,0b0000000000000000,0b0000000000000000}, // >
	{0b0001110000000000,0b0011110000000000,0b0011000011001100,0b0011001111001100,0b0011111100000000,0b0001110000000000,0b0000000000000000,0b0000000000000000}, // ?
	{0b0001111111111000,0b0011111111111100,0b0011000000001100,0b0011001111001100,0b0011111111001100,0b0001111111001100,0b0000000000000000,0b0000000000000000}, // @
	{0b0000011111111100,0b0000111111111100,0b0011110000110000,0b0011110000110000,0b0000111111111100,0b0000011111111100,0b0000000000000000,0b0000000000000000}, // A
	{0b0011111111111100,0b0011111111111100,0b0011001100001100,0b0011001100001100,0b0011111111111100,0b0001110011111000,0b0000000000000000,0b0000000000000000}, // B
	{0b0001111111111000,0b0011111111111100,0b0011000000001100,0b0011000000001100,0b0011110000111100,0b0001110000111000,0b0000000000000000,0b0000000000000000}, // C
	{0b0011111111111100,0b0011111111111100,0b0011000000001100,0b0011100000011100,0b0001111111111000,0b0000011111100000,0b0000000000000000,0b0000000000000000}, // D
	{0b0011111111111100,0b0011111111111100,0b0011001100001100,0b0011001100001100,0b0011001100001100,0b0011000000001100,0b0000000000000000,0b0000000000000000}, // E
	{0b0011111111111100,0b0011111111111100,0b0011001100000000,0b0011001100000000,0b0011001100000000,0b0011000000000000,0b0000000000000000,0b0000000000000000}, // F
	{0b0001111111111000,0b0011111111111100,0b0011000000001100,0b0011000011001100,0b0011000011111100,0b0011000011111100,0b0000000000000000,0b0000000000000000}, // G
	{0b0011111111111100,0b0011111111111100,0b0000001100000000,0b0000001100000000,0b0011111111111100,0b0011111111111100,0b0000000000000000,0b0000000000000000}, // H
	{0b0011000000001100,0b0011000000001100,0b0011111111111100,0b0011111111111100,0b0011000000001100,0b0011000000001100,0b0000000000000000,0b0000000000000000}, // I
	{0b0000000000111000,0b0000000000111100,0b0000000000001100,0b0011000000001100,0b0011111111111100,0b0011111111111000,0b0000000000000000,0b0000000000000000}, // J
	{0b0011111111111100,0b0011111111111100,0b0000001111000000,0b0000111111110000,0b0011110000111100,0b0011000000001100,0b0000000000000000,0b0000000000000000}, // K
	{0b0011111111111100,0b0011111111111100,0b0000000000001100,0b0000000000001100,0b0000000000001100,0b0000000000001100,0b0000000000000000,0b0000000000000000}, // L
	{0b0011111111111100,0b0011111111111100,0b0000111100000000,0b0000001111000000,0b0000111100000000,0b0011111111111100,0b0011111111111100,0b0000000000000000}, // M
	{0b0011111111111100,0b0011111111111100,0b0000111111000000,0b0000001111110000,0b0011111111111100,0b0011111111111100,0b0000000000000000,0b0000000000000000}, // N
	{0b0001111111111000,0b0011111111111100,0b0011000000001100,0b0011000000001100,0b0011111111111100,0b0001111111111000,0b0000000000000000,0b0000000000000000}, // O
	{0b0011111111111100,0b0011111111111100,0b0011000011000000,0b0011000011000000,0b0011111111000000,0b0001111110000000,0b0000000000000000,0b0000000000000000}, // P
	{0b0001111111111000,0b0011111111111100,0b0011000000001100,0b0011000000111000,0b0011111111111100,0b0001111111101100,0b0000000000000000,0b0000000000000000}, // Q
	{0b0011111111111100,0b0011111111111100,0b0011000011000000,0b0011000011100000,0b0011111111111100,0b0001111110011100,0b0000000000000000,0b0000000000000000}, // R
	{0b0001111000001100,0b0011111100001100,0b0011001100001100,0b0011001100001100,0b0011001111111100,0b0011000111111000,0b0000000000000000,0b0000000000000000}, // S
	{0b0011000000000000,0b0011000000000000,0b0011111111111100,0b0011111111111100,0b0011000000000000,0b0011000000000000,0b0000000000000000,0b0000000000000000}, // T
	{0b0011111111111000,0b0011111111111100,0b0000000000001100,0b0000000000001100,0b0011111111111100,0b0011111111111000,0b0000000000000000,0b0000000000000000}, // U
	{0b0011111111100000,0b0011111111110000,0b0000000000111100,0b0000000000111100,0b0011111111110000,0b0011111111100000,0b0000000000000000,0b0000000000000000}, // V
	{0b0011111111111100,0b0011111111111100,0b0000000011110000,0b0000001111000000,0b0000000011110000,0b0011111111111100,0b0011111111111100,0b0000000000000000}, // W
	{0b0011000000011100,0b0011110001111100,0b0000111111100000,0b0000111111100000,0b0011110001111100,0b0011000000011100,0b0000000000000000,0b0000000000000000}, // X
	{0b0011111000000000,0b0011111100000000,0b0000001111111100,0b0000001111111100,0b0011111100000000,0b0011111000000000,0b0000000000000000,0b0000000000000000}, // Y
	{0b0011000000111100,0b0011000011111100,0b0011001111001100,0b0011111100001100,0b0011110000001100,0b0011000000001100,0b0000000000000000,0b0000000000000000}, // Z
	{0b0000000000000000,0b0000000000000000,0b0011111111111100,0b0011111111111100,0b0011000000001100,0b0011000000001100,0b0000000000000000,0b0000000000000000}, // [
	{0b0011000000000000,0b0011110000000000,0b0000111100000000,0b0000001111000000,0b0000000011110000,0b0000000000111100,0b0000000000001100,0b0000000000000000}, // \slash
	{0b0011000000001100,0b0011000000001100,0b0011111111111100,0b0011111111111100,0b0000000000000000,0b0000000000000000,0b0000000000000000,0b0000000000000000}, // ]
	{0b0000000011000000,0b0000001111000000,0b0000111100000000,0b0011110000000000,0b0000111100000000,0b0000001111000000,0b0000000011000000,0b0000000000000000}, // ^
	{0b0000000000001100,0b0000000000001100,0b0000000000001100,0b0000000000001100,0b0000000000001100,0b0000000000001100,0b0000000000001100,0b0000000000000000}, // _
	{0b0011100000000000,0b0001110000000000,0b0000111000000000,0b0000011100000000,0b0000000000000000,0b0000000000000000,0b0000000000000000,0b0000000000000000}, // `
	{0b0000000001111000,0b0000110011111100,0b0000110011001100,0b0000110011001100,0b0000111111111100,0b0000011111111100,0b0000000000000000,0b0000000000000000}, // a
	{0b0011111111111100,0b0011111111111100,0b0000011000001100,0b0000011000001100,0b0000011111111100,0b0000001111111000,0b0000000000000000,0b0000000000000000}, // b
	{0b0000011111111000,0b0000111111111100,0b0000110000001100,0b0000110000001100,0b0000110000001100,0b0000000000000000,0b0000000000000000,0b0000000000000000}, // c
	{0b0000001111111000,0b0000011111111100,0b0000011000001100,0b0000011000001100,0b0011111111111100,0b0011111111111100,0b0000000000000000,0b0000000000000000}, // d
	{0b0000011111111000,0b0000111111111100,0b0000110011001100,0b0000110011001100,0b0000111111001100,0b0000011111001100,0b0000000000000000,0b0000000000000000}, // e
	{0b0000000000000000,0b0000011000000000,0b0001111111111100,0b0011111111111100,0b0011011000000000,0b0011011000000000,0b0000000000000000,0b0000000000000000}, // f
	{0b0000011111100011,0b0000111111110011,0b0000110000110011,0b0000110000110011,0b0000111111111111,0b0000111111111110,0b0000000000000000,0b0000000000000000}, // g
	{0b0011111111111100,0b0011111111111100,0b0000011000000000,0b0000011000000000,0b0000011111111100,0b0000001111111100,0b0000000000000000,0b0000000000000000}, // h
	{0b0000000000000000,0b0000011000001100,0b0011011111111100,0b0011011111111100,0b0000000000001100,0b0000000000000000,0b0000000000000000,0b0000000000000000}, // i
	{0b0000000000000000,0b0000000000000011,0b0000000000000011,0b0000000000000011,0b0011011111111111,0b0011011111111110,0b0000000000000000,0b0000000000000000}, // j
	{0b0011111111111100,0b0011111111111100,0b0000000111000000,0b0000011111110000,0b0000011000111100,0b0000000000001100,0b0000000000000000,0b0000000000000000}, // k
	{0b0000000000000000,0b0011000000001100,0b0011111111111100,0b0011111111111100,0b0000000000001100,0b0000000000000000,0b0000000000000000,0b0000000000000000}, // l
	{0b0000111111111100,0b0000111111111100,0b0000001111000000,0b0000000011110000,0b0000111111000000,0b0000111111111100,0b0000001111111100,0b0000000000000000}, // m
	{0b0000111111111100,0b0000111111111100,0b0000110000000000,0b0000110000000000,0b0000111111111100,0b0000011111111100,0b0000000000000000,0b0000000000000000}, // n
	{0b0000011111111000,0b0000111111111100,0b0000110000001100,0b0000110000001100,0b0000111111111100,0b0000011111111000,0b0000000000000000,0b0000000000000000}, // o
	{0b0000111111111111,0b0000111111111111,0b0000110000110000,0b0000110000110000,0b0000111111110000,0b0000011111100000,0b0000000000000000,0b0000000000000000}, // p
	{0b0000011111100000,0b0000111111110000,0b0000110000110000,0b0000110000110000,0b0000111111111111,0b0000011111111111,0b0000000000000000,0b0000000000000000}, // q
	{0b0000111111111100,0b0000111111111100,0b0000110000000000,0b0000110000000000,0b0000111100000000,0b0000011100000000,0b0000000000000000,0b0000000000000000}, // r
	{0b0000011110001100,0b0000111111001100,0b0000110011001100,0b0000110011001100,0b0000110011111100,0b0000110001111000,0b0000000000000000,0b0000000000000000}, // s
	{0b0000110000000000,0b0000110000000000,0b0011111111111000,0b0011111111111100,0b0000110000001100,0b0000110000001100,0b0000000000000000,0b0000000000000000}, // t
	{0b0000011111111111,0b0000011111111111,0b0000000000001100,0b0000000000001100,0b0000011111111100,0b0000011111111100,0b0000000000001100,0b0000000000000000}, // u
	{0b0000111111100000,0b0000111111110000,0b0000000000111100,0b0000000000111100,0b0000111111110000,0b0000111111100000,0b0000000000000000,0b0000000000000000}, // v
	{0b0000111111000000,0b0000111111111100,0b0000000011111100,0b0000001111110000,0b0000000011111100,0b0000111111111100,0b0000111111000000,0b0000000000000000}, // w
	{0b0000110000001100,0b0000111100111100,0b0000001111110000,0b0000001111110000,0b0000111100111100,0b0000110000001100,0b0000000000000000,0b0000000000000000}, // x
	{0b0000111111100011,0b0000111111110011,0b0000000000110011,0b0000000000111111,0b0000111111111110,0b0000111111111000,0b0000000000000000,0b0000000000000000}, // y
	{0b0000110000001100,0b0000110000111100,0b0000110011111100,0b0000111111001100,0b0000111100001100,0b0000110000001100,0b0000000000000000,0b0000000000000000}  // z
};

// Send a byte (a command or pixel data) to the LCD.
void lcd_write_register(enum REGISTER reg, uint8_t data) {
	(data & (1 << 7)) ? (GPIOB->BSRR = 1 << 6) : (GPIOB->BSRR = 1 << 6 + 16);
	(data & (1 << 6)) ? (GPIOB->BSRR = 1 << 7) : (GPIOB->BSRR = 1 << 7 + 16);
	(data & (1 << 5)) ? (GPIOB->BSRR = 1 << 8) : (GPIOB->BSRR = 1 << 8 + 16);
	(data & (1 << 4)) ? (GPIOB->BSRR = 1 << 9) : (GPIOB->BSRR = 1 << 9 + 16);
	(data & (1 << 3)) ? (GPIOB->BSRR = 1 << 10) : (GPIOB->BSRR = 1 << 10 + 16);
	(data & (1 << 2)) ? (GPIOB->BSRR = 1 << 11) : (GPIOB->BSRR = 1 << 11 + 16);
	(data & (1 << 1)) ? (GPIOB->BSRR = 1 << 12) : (GPIOB->BSRR = 1 << 12 + 16);
	(data & (1 << 0)) ? (GPIOB->BSRR = 1 << 13) : (GPIOB->BSRR = 1 << 13 + 16);
	(reg == DATA)     ? (GPIOB->BSRR = 1 << 4) : (GPIOB->BSRR = 1 << 4 + 16);
	//delay(1);
	GPIOB->BSRR = 1 << 5 + 16;
	//delay(1);
	GPIOB->BSRR = 1 << 5;
	//delay(1);
}

// Initialize the LCD
void lcd_init(enum GPIO_PIN _cd, enum GPIO_PIN _wr1, enum GPIO_PIN _d7, enum GPIO_PIN _d6, enum GPIO_PIN _d5,
			  enum GPIO_PIN _d4, enum GPIO_PIN _d3, enum GPIO_PIN _d2, enum GPIO_PIN _d1, enum GPIO_PIN _d0) {
	SysTick_Config(SystemCoreClock / 1000000);
	
	// Copy pin values to the global variables
	cd = _cd;
	wr1 = _wr1;
	d7 = _d7;
	d6 = _d6;
	d5 = _d5;
	d4 = _d4;
	d3 = _d3;
	d2 = _d2;
	d1 = _d1;
	d0 = _d0;
	
	// Enable GPIO clocks and output mode for those pins
	EnablePin(cd);
	EnablePin(wr1);
	EnablePin(d7);
	EnablePin(d6);
	EnablePin(d5);
	EnablePin(d4);
	EnablePin(d3);
	EnablePin(d2);
	EnablePin(d1);
	EnablePin(d0);

	delay(40000); // Wait for LCD
	delay(100000); // Wait 0.1s. This is not required, but works around power supplies with slow rise times.
	
	// The following commands are used by the Airtronics M11 radio.
	// Commands 10 and 11 were removed because they do not seem to be needed.
	lcd_write_register(COMMAND, 0b11100010); // 1 system reset
	lcd_write_register(COMMAND, 0b00100000); // 2 mux rate, temp comp
	lcd_write_register(COMMAND, 0b11000101); // 3 lcd mapping
	lcd_write_register(COMMAND, 0b11101000); // 4 lcd bias
	lcd_write_register(COMMAND, 0b10000001); // 5 gain and pot
	lcd_write_register(COMMAND, 0b11000000); // 6 gain and pot
	lcd_write_register(COMMAND, 0b10101111); // 7 display enable
	lcd_write_register(COMMAND, 0b11101110); // 8 reset cursor mode
	lcd_write_register(COMMAND, 0b01000000); // 9 start line = 0
	//lcd_write_register(COMMAND, 0b10100101); // 10 all pixels on
	//lcd_write_register(COMMAND, 0b10100100); // 11 all pixels off
	lcd_write_register(COMMAND, 0b10001001); // 12 ram address control = 1
	lcd_write_register(COMMAND, 0b10110000); // 13 page = 0
}

// Write one character to the pixel buffer.  line = 0-5, charOffset = 0-29, letter= ASCII 32-122
void lcd_write_char16(uint8_t line, uint8_t charOffset, uint8_t letter) {
	//if((line > 5) || charOffset > 29 || letter < 32 || letter > 122) return; // bad arguments
	
	line *= 2;
	
	pixBuf[(charOffset*8)+0][line]   = font[letter-32][0] >> 8;
	pixBuf[(charOffset*8)+0][line+1] = font[letter-32][0] & 255;
	pixBuf[(charOffset*8)+1][line]   = font[letter-32][1] >> 8;
	pixBuf[(charOffset*8)+1][line+1] = font[letter-32][1] & 255;
	pixBuf[(charOffset*8)+2][line]   = font[letter-32][2] >> 8;
	pixBuf[(charOffset*8)+2][line+1] = font[letter-32][2] & 255;
	pixBuf[(charOffset*8)+3][line]   = font[letter-32][3] >> 8;
	pixBuf[(charOffset*8)+3][line+1] = font[letter-32][3] & 255;
	pixBuf[(charOffset*8)+4][line]   = font[letter-32][4] >> 8;
	pixBuf[(charOffset*8)+4][line+1] = font[letter-32][4] & 255;
	pixBuf[(charOffset*8)+5][line]   = font[letter-32][5] >> 8;
	pixBuf[(charOffset*8)+5][line+1] = font[letter-32][5] & 255;
	pixBuf[(charOffset*8)+6][line]   = font[letter-32][6] >> 8;
	pixBuf[(charOffset*8)+6][line+1] = font[letter-32][6] & 255;
	pixBuf[(charOffset*8)+7][line]   = font[letter-32][7] >> 8;
	pixBuf[(charOffset*8)+7][line+1] = font[letter-32][7] & 255;
}

// Write one line to the pixel buffer, padding the end with spaces if needed.  line = 0-5, string = a c-string
void lcd_write_line16(uint8_t line, char string[]) {
	//if(line > 5) return; // bad argument
	
	uint8_t i = 0;
	while((string[i] != 0) && (i < 30)) {
		lcd_write_char16(line, i, string[i]);
		i++;
	}
	
	while(i < 30) {
		lcd_write_char16(line, i, ' ');
		i++;
	}
}

// Draw an underline in the pixel buffer.  x1 = 0-29, x2 = 0-29, y = 0-4
void lcd_write_underline(uint8_t x1, uint8_t x2, uint8_t y) {
	//if((x1 > 29) || (x2 > 29) || (x2 <= x1) || (y > 4)) return; // bad argument
	
	uint8_t i;
	for(i = x1*8; i <= x2*8+8; i++) {
		pixBuf[i][(y*2)+1] |= (1 << 0);
	}
}

// Send the pixel buffer data to the LCD
void lcd_write_pixbuf() {
	uint8_t x, y;
	
	lcd_write_register(COMMAND, 0b10110000); // page = 0
	lcd_write_register(COMMAND, 0b00000000); // column = 0 (byte1)
	lcd_write_register(COMMAND, 0b00010000); // column = 0 (byte2)
	
	for(y = 0; y < 12; y++)
		for(x = 0; x < 240; x++)			
			lcd_write_register(DATA, pixBuf[x][y]);
}
